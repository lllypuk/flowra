{{define "workspace/settings.html"}}
<!doctype html>
<html lang="en" data-theme="light">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>{{if .Title}}{{.Title}} - {{end}}Flowra</title>

        <!-- Pico CSS -->
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css"
        />

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/static/css/custom.css" />

        <!-- Board CSS - always loaded to support hx-boost navigation -->
        <link rel="stylesheet" href="/static/css/board.css" />

        <!-- HTMX -->
        <script
            src="https://unpkg.com/htmx.org@2.0.0"
            crossorigin="anonymous"
        ></script>

        <!-- HTMX WebSocket Extension -->
        <script src="https://unpkg.com/htmx-ext-ws@2.0.0/ws.js"></script>
    </head>
    <body hx-boost="true">
        {{template "navbar" .}}

        <div class="workspace-layout">
            <!-- Sidebar -->
            <aside class="workspace-sidebar">
                <header>
                    <h2>{{.Data.Workspace.Name}}</h2>
                    <a
                        href="/workspaces/{{.Data.Workspace.ID}}/settings"
                        title="Settings"
                        aria-current="page"
                    >
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="20"
                            height="20"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                        >
                            <circle cx="12" cy="12" r="3"></circle>
                            <path
                                d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"
                            ></path>
                        </svg>
                    </a>
                </header>

                <nav>
                    <ul>
                        <li>
                            <a href="/workspaces/{{.Data.Workspace.ID}}/chats">
                                Chats
                            </a>
                        </li>
                        <li>
                            <a href="/workspaces/{{.Data.Workspace.ID}}/board">
                                Board
                            </a>
                        </li>
                        <li>
                            <a
                                href="/workspaces/{{.Data.Workspace.ID}}/members"
                            >
                                Members
                                <small class="text-muted"
                                    >({{.Data.Workspace.MemberCount}})</small
                                >
                            </a>
                        </li>
                    </ul>
                </nav>

                <!-- Quick actions -->
                <div class="sidebar-actions">
                    <button
                        hx-get="/partials/chat/create-form?workspace_id={{.Data.Workspace.ID}}"
                        hx-target="#modal-container"
                        hx-swap="innerHTML"
                        class="outline"
                    >
                        + New Chat
                    </button>
                </div>
            </aside>

            <!-- Main content -->
            <main class="workspace-main">
                <div class="settings-page">
                    <header class="page-header">
                        <h2>Workspace Settings</h2>
                    </header>

                    <article>
                        <header>
                            <h3>General</h3>
                        </header>

                        <form
                            hx-put="/api/v1/workspaces/{{.Data.Workspace.ID}}"
                            hx-swap="none"
                            hx-on::after-request="if(event.detail.successful) alert('Settings saved!')"
                        >
                            <label for="name">
                                Workspace Name
                                <input
                                    type="text"
                                    id="name"
                                    name="name"
                                    value="{{.Data.Workspace.Name}}"
                                    required
                                    minlength="3"
                                    maxlength="100"
                                />
                            </label>

                            <label for="description">
                                Description
                                <textarea
                                    id="description"
                                    name="description"
                                    maxlength="500"
                                    rows="3"
                                >
{{.Data.Workspace.Description}}</textarea
                                >
                            </label>

                            <button type="submit">Save Changes</button>
                        </form>
                    </article>

                    {{if eq .Data.UserRole "owner"}}
                    <article class="danger-zone">
                        <header>
                            <h3>Danger Zone</h3>
                        </header>

                        <p class="text-muted">
                            Once you delete a workspace, there is no going back.
                            Please be certain.
                        </p>

                        <button
                            class="secondary outline"
                            hx-delete="/api/v1/workspaces/{{.Data.Workspace.ID}}"
                            hx-confirm="Are you sure you want to delete this workspace? This action cannot be undone."
                            hx-on::after-request="if(event.detail.successful) window.location.href='/workspaces'"
                        >
                            Delete Workspace
                        </button>
                    </article>
                    {{end}}
                </div>
            </main>

            <!-- Modal container -->
            <div id="modal-container"></div>
        </div>

        {{template "footer" .}}

        <script src="/static/js/app.js"></script>

        <style>
            .workspace-layout {
                display: grid;
                grid-template-columns: 250px 1fr;
                min-height: calc(100vh - 60px);
            }

            .workspace-sidebar {
                background: var(--card-background-color);
                border-right: 1px solid var(--muted-border-color);
                padding: 1rem;
            }

            .workspace-sidebar header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 1rem;
            }

            .workspace-sidebar header h2 {
                margin: 0;
                font-size: 1.25rem;
            }

            .workspace-sidebar nav ul {
                list-style: none;
                padding: 0;
                margin: 0;
            }

            .workspace-sidebar nav a {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 0.5rem 0.75rem;
                border-radius: 4px;
                text-decoration: none;
            }

            .workspace-sidebar nav a[aria-current="page"] {
                background: var(--primary-focus);
            }

            .sidebar-actions {
                margin-top: 2rem;
            }

            .workspace-main {
                padding: 1.5rem;
                overflow-y: auto;
            }

            .settings-page .page-header {
                margin-bottom: 1.5rem;
            }

            .settings-page .page-header h2 {
                margin: 0;
            }

            .danger-zone {
                border-color: var(--del-color);
            }

            .danger-zone header h3 {
                color: var(--del-color);
            }

            @media (max-width: 768px) {
                .workspace-layout {
                    grid-template-columns: 1fr;
                }

                .workspace-sidebar {
                    display: none;
                }
            }
        </style>
    </body>
</html>
{{end}}
