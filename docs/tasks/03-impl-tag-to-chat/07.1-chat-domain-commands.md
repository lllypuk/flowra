# Task 07.1: Chat Domain Commands

**Статус:** ✅ Completed
**Приоритет:** High
**Зависимости:** нет
**Оценка:** 0.5 дня

## Описание

Создать domain commands для Chat aggregate. Эти команды представляют намерения изменить состояние чата и будут использоваться CommandExecutor'ом.

## Контекст

В проекте уже есть:
- `internal/domain/tag/commands.go` - tag команды от процессора (CreateTaskCommand, ChangeStatusCommand и т.д.)
- `internal/domain/chat/chat.go` - Chat aggregate с базовым функционалом

Нужно создать **domain commands** на уровне Chat aggregate, которые будут:
1. Представлять бизнес-операции
2. Содержать все необходимые данные для выполнения
3. Валидироваться перед выполнением
4. Использоваться в CommandExecutor

## Цели

1. Создать файл `internal/domain/chat/commands.go`
2. Определить все domain commands
3. Добавить методы для получения типа команды

## Технические требования

### Файл: `internal/domain/chat/commands.go`

```go
package chat

import (
	"time"

	"github.com/lllypuk/teams-up/internal/domain/uuid"
)

// Command представляет команду для Chat aggregate
type Command interface {
	CommandType() string
	AggregateID() uuid.UUID
}

// ====== Entity Creation Commands ======

// ConvertToTaskCommand превращает Discussion чат в Task
type ConvertToTaskCommand struct {
	ChatID uuid.UUID
	Title  string
	UserID uuid.UUID // кто выполнил команду
}

func (c ConvertToTaskCommand) CommandType() string {
	return "ConvertToTask"
}

func (c ConvertToTaskCommand) AggregateID() uuid.UUID {
	return c.ChatID
}

// ConvertToBugCommand превращает Discussion чат в Bug
type ConvertToBugCommand struct {
	ChatID uuid.UUID
	Title  string
	UserID uuid.UUID
}

func (c ConvertToBugCommand) CommandType() string {
	return "ConvertToBug"
}

func (c ConvertToBugCommand) AggregateID() uuid.UUID {
	return c.ChatID
}

// ConvertToEpicCommand превращает Discussion чат в Epic
type ConvertToEpicCommand struct {
	ChatID uuid.UUID
	Title  string
	UserID uuid.UUID
}

func (c ConvertToEpicCommand) CommandType() string {
	return "ConvertToEpic"
}

func (c ConvertToEpicCommand) AggregateID() uuid.UUID {
	return c.ChatID
}

// ====== Entity Management Commands ======

// ChangeStatusCommand изменяет статус typed чата
type ChangeStatusCommand struct {
	ChatID uuid.UUID
	Status string
	UserID uuid.UUID
}

func (c ChangeStatusCommand) CommandType() string {
	return "ChangeStatus"
}

func (c ChangeStatusCommand) AggregateID() uuid.UUID {
	return c.ChatID
}

// AssignUserCommand назначает или снимает исполнителя
type AssignUserCommand struct {
	ChatID     uuid.UUID
	AssigneeID *uuid.UUID // nil = снять assignee
	UserID     uuid.UUID
}

func (c AssignUserCommand) CommandType() string {
	return "AssignUser"
}

func (c AssignUserCommand) AggregateID() uuid.UUID {
	return c.ChatID
}

// SetPriorityCommand устанавливает приоритет
type SetPriorityCommand struct {
	ChatID   uuid.UUID
	Priority string
	UserID   uuid.UUID
}

func (c SetPriorityCommand) CommandType() string {
	return "SetPriority"
}

func (c SetPriorityCommand) AggregateID() uuid.UUID {
	return c.ChatID
}

// SetDueDateCommand устанавливает или снимает дедлайн
type SetDueDateCommand struct {
	ChatID  uuid.UUID
	DueDate *time.Time // nil = снять due date
	UserID  uuid.UUID
}

func (c SetDueDateCommand) CommandType() string {
	return "SetDueDate"
}

func (c SetDueDateCommand) AggregateID() uuid.UUID {
	return c.ChatID
}

// RenameChatCommand изменяет название чата
type RenameChatCommand struct {
	ChatID   uuid.UUID
	NewTitle string
	UserID   uuid.UUID
}

func (c RenameChatCommand) CommandType() string {
	return "RenameChat"
}

func (c RenameChatCommand) AggregateID() uuid.UUID {
	return c.ChatID
}

// SetSeverityCommand устанавливает severity для Bug
type SetSeverityCommand struct {
	ChatID   uuid.UUID
	Severity string
	UserID   uuid.UUID
}

func (c SetSeverityCommand) CommandType() string {
	return "SetSeverity"
}

func (c SetSeverityCommand) AggregateID() uuid.UUID {
	return c.ChatID
}
```

## Acceptance Criteria

- [ ] Создан файл `internal/domain/chat/commands.go`
- [ ] Определены все Entity Creation Commands (ConvertToTask, ConvertToBug, ConvertToEpic)
- [ ] Определены все Entity Management Commands (ChangeStatus, AssignUser, SetPriority, SetDueDate, RenameChat, SetSeverity)
- [ ] Все команды имеют методы CommandType() и AggregateID()
- [ ] Все команды содержат UserID для audit trail
- [ ] Код компилируется без ошибок

## Примечания

1. **UserID в командах**: Каждая команда содержит UserID того, кто выполнил команду. Это нужно для:
   - Audit trail
   - Создания events с правильным metadata
   - Проверки прав доступа (в будущем)

2. **Nullable поля**:
   - `AssigneeID *uuid.UUID` - nil означает "снять assignee"
   - `DueDate *time.Time` - nil означает "снять due date"

3. **Связь с tag commands**:
   - Tag commands (`internal/domain/tag/commands.go`) создаются TagProcessor'ом
   - Domain commands (`internal/domain/chat/commands.go`) будут создаваться CommandExecutor'ом
   - Executor будет преобразовывать tag commands → domain commands

## Тесты

Для этой задачи не требуются отдельные тесты, т.к. это просто структуры данных. Тестироваться будут в контексте использования (Task 07.6).

## Ссылки

- Следующая задача: [07.2 - Chat Domain Events](./07.2-chat-domain-events.md)
- Родительская задача: [07 - Integration with Domain](../impl-tag-grammar/07-integration-with-domain.md)
